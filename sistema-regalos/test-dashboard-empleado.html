<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Dashboard Empleado</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Test de Funcionalidad Dashboard Empleado</h1>
        
        <div class="alert alert-info">
            <strong>Instrucciones:</strong> Abre la consola del navegador (F12) para ver los mensajes de debug.
        </div>
        
        <div class="card mt-4">
            <div class="card-body">
                <h5>1. Verificar Token</h5>
                <button class="btn btn-primary" onclick="verificarToken()">Verificar Token</button>
                <div id="resultToken" class="mt-2"></div>
            </div>
        </div>
        
        <div class="card mt-4">
            <div class="card-body">
                <h5>2. Test Bot√≥n Registrar Hijo</h5>
                <button class="btn btn-success" id="btnTestRegistrar">Test Registrar Hijo</button>
                <div id="resultRegistrar" class="mt-2"></div>
            </div>
        </div>
        
        <div class="card mt-4">
            <div class="card-body">
                <h5>3. Test Cargar Hijos</h5>
                <button class="btn btn-info" onclick="testCargarHijos()">Test Cargar Hijos</button>
                <div id="resultHijos" class="mt-2"></div>
            </div>
        </div>
        
        <div class="card mt-4">
            <div class="card-body">
                <h5>4. Test Cargar Estad√≠sticas</h5>
                <button class="btn btn-warning" onclick="testEstadisticas()">Test Estad√≠sticas</button>
                <div id="resultEstadisticas" class="mt-2"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        console.log('üß™ P√°gina de test cargada');
        
        function verificarToken() {
            const token = localStorage.getItem('coomotor_token');
            const user = localStorage.getItem('coomotor_user');
            const resultDiv = document.getElementById('resultToken');
            
            if (token && user) {
                const userData = JSON.parse(user);
                resultDiv.innerHTML = `
                    <div class="alert alert-success">
                        ‚úÖ Token encontrado<br>
                        Usuario: ${userData.nombres} ${userData.apellidos}<br>
                        Rol: ${userData.rol}
                    </div>
                `;
                console.log('‚úÖ Token:', token.substring(0, 20) + '...');
                console.log('‚úÖ Usuario:', userData);
            } else {
                resultDiv.innerHTML = `
                    <div class="alert alert-danger">
                        ‚ùå No hay token. Debes hacer login primero.<br>
                        <a href="../sistema-regalos/auth/login.html" class="btn btn-sm btn-primary mt-2">Ir a Login</a>
                    </div>
                `;
                console.error('‚ùå No hay token en localStorage');
            }
        }
        
        async function testCargarHijos() {
            console.log('üß™ Probando cargar hijos...');
            const resultDiv = document.getElementById('resultHijos');
            const token = localStorage.getItem('coomotor_token');
            
            if (!token) {
                resultDiv.innerHTML = '<div class="alert alert-danger">‚ùå No hay token. Haz login primero.</div>';
                return;
            }
            
            try {
                resultDiv.innerHTML = '<div class="alert alert-info">‚è≥ Cargando...</div>';
                
                const response = await fetch('/api/hijos', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                console.log('üì° Response status:', response.status);
                const result = await response.json();
                console.log('üì° Response data:', result);
                
                if (result.success) {
                    resultDiv.innerHTML = `
                        <div class="alert alert-success">
                            ‚úÖ API funcionando correctamente<br>
                            Hijos encontrados: ${result.data.length}<br>
                            <pre>${JSON.stringify(result.data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="alert alert-warning">
                            ‚ö†Ô∏è API respondi√≥ pero con error:<br>
                            ${result.error || 'Error desconocido'}
                        </div>
                    `;
                }
            } catch (error) {
                console.error('‚ùå Error:', error);
                resultDiv.innerHTML = `
                    <div class="alert alert-danger">
                        ‚ùå Error de conexi√≥n:<br>
                        ${error.message}
                    </div>
                `;
            }
        }
        
        async function testEstadisticas() {
            console.log('üß™ Probando cargar estad√≠sticas...');
            const resultDiv = document.getElementById('resultEstadisticas');
            const token = localStorage.getItem('coomotor_token');
            
            if (!token) {
                resultDiv.innerHTML = '<div class="alert alert-danger">‚ùå No hay token. Haz login primero.</div>';
                return;
            }
            
            try {
                resultDiv.innerHTML = '<div class="alert alert-info">‚è≥ Cargando...</div>';
                
                const response = await fetch('/api/empleados/estadisticas', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                console.log('üì° Response status:', response.status);
                const result = await response.json();
                console.log('üì° Response data:', result);
                
                if (result.success) {
                    resultDiv.innerHTML = `
                        <div class="alert alert-success">
                            ‚úÖ API funcionando correctamente<br>
                            <pre>${JSON.stringify(result.data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="alert alert-warning">
                            ‚ö†Ô∏è API respondi√≥ pero con error:<br>
                            ${result.error || 'Error desconocido'}
                        </div>
                    `;
                }
            } catch (error) {
                console.error('‚ùå Error:', error);
                resultDiv.innerHTML = `
                    <div class="alert alert-danger">
                        ‚ùå Error de conexi√≥n:<br>
                        ${error.message}
                    </div>
                `;
            }
        }
        
        // Test del bot√≥n
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîµ DOM cargado');
            
            const btnTest = document.getElementById('btnTestRegistrar');
            if (btnTest) {
                console.log('‚úÖ Bot√≥n encontrado');
                btnTest.addEventListener('click', function() {
                    console.log('üñ±Ô∏è Click en bot√≥n test');
                    const resultDiv = document.getElementById('resultRegistrar');
                    resultDiv.innerHTML = `
                        <div class="alert alert-success">
                            ‚úÖ El bot√≥n funciona correctamente!<br>
                            El evento click se est√° detectando.
                        </div>
                    `;
                });
            } else {
                console.error('‚ùå Bot√≥n NO encontrado');
            }
            
            // Auto-verificar token al cargar
            verificarToken();
        });
    </script>
</body>
</html>
